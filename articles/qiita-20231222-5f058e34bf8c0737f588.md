---
title: "AWS AppSync ãŒã‚¢ãƒ„ã„ï¼ RDS Data API ã‚’ä½¿ã£ã¦ GraphQL API ã‚’çˆ†é€Ÿã§ä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ˜€"
type: "tech"
topics: [AWS,Aurora,GraphQL,AppSync,AuroraServerlessV2]
published: false
published_at: 2023-12-22 17:42
---
:::note warn
æœ¬è¨˜äº‹ã®ç¶šç·¨ã‚’å‡ºã—ã¾ã—ãŸã€‚ãœã²ã“ã¡ã‚‰ã®è¨˜äº‹ã‹ã‚‰ãŠèª­ã¿ãã ã•ã„ã€‚
:::
https://qiita.com/inada_riku/items/f4cd77c254fb6fd6f81e


ã“ã‚“ã«ã¡ã¯ã€‚[ã„ãªã‚Šã](https://twitter.com/inada_riku)ã§ã™âœ‹
æœ¬è¨˜äº‹ã¯ã€[AWS Amplify ã¨ AWS Ã— ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ #AWSAmplifyJP Advent Calendar 2023](https://qiita.com/advent-calendar/2023/amplify) ã® 22 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

:::note warn
æœ¬è¨˜äº‹ã¯ 2023 å¹´ 12 æœˆ 23 æ—¥æ™‚ç‚¹ã®æƒ…å ±ã«åŸºã¥ã„ã¦åŸ·ç­†ã—ã¦ã„ã¾ã™ã€‚
:::

2023 å¹´ 11 æœˆ 27 æ—¥ã«ã€AWS AppSync ã¯ RDS Data API ã‚’ä½¿ç”¨ã—ã¦ Amazon Aurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦[ã‚¤ãƒ³ãƒˆãƒ­ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³](https://graphql.org/learn/introspection/)ã‚’è¡Œã†ã“ã¨ã§ã€æ¤œå‡ºã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã«é©åˆã—ãŸ GraphQL API ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’ç°¡å˜ã«ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚


>[RDS Data API ã‚’ä½¿ç”¨ã—ã¦è¨­å®šã•ã‚ŒãŸ Amazon Aurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å¯¾ã™ã‚‹ AWS AppSync ã®ã‚µãƒãƒ¼ãƒˆãŒæ”¹å–„](https://aws.amazon.com/jp/about-aws/whats-new/2023/11/aws-appsync-aurora-clusters-rds-data-api/)


ã™ã”ã„ä¾¿åˆ©ãªæ©Ÿèƒ½ã§ã™ãŒã€RDS Data API ãŒ **2023 å¹´ 11 æœˆ 27 æ—¥æ™‚ç‚¹ã§ã¯** Aurora Serverless v1 ã®ã¿ã®å¯¾å¿œã ã£ãŸãŸã‚åˆ©ç”¨ã§ãã‚‹ã‚±ãƒ¼ã‚¹ãŒé™å®šçš„ã§ã—ãŸã€‚

ã—ã‹ã—ã€ã¡ã‚‡ã†ã©æ˜¨æ—¥ (2023 å¹´ 12 æœˆ 21 æ—¥)ã€[Amazon Aurora PostgreSQL ã® Serverless v2 ã¨ Provisoned ã§ RDS Data API ãŒå¯¾å¿œã—ãŸ](https://aws.amazon.com/jp/about-aws/whats-new/2023/12/amazon-aurora-postgresql-rds-data-api/)ãŸã‚ã€AWS AppSync ã®æ–°ã—ã„æ©Ÿèƒ½ã®åˆ©ç”¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒåºƒãŒã‚Šã¾ã—ãŸã€‚


>è£œè¶³ : [ç¾åœ¨ (2023 å¹´ 12 æœˆ 22 æ—¥)ã€Aurora PostgreSQLã§ã¯ã€Data API ã¯ Aurora Serverless v2ã€Aurora Serverless v1ã€ãŠã‚ˆã³ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚Aurora MySQL ã§ã¯ã€Data API ã¯ Aurora Serverless v1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã®ã¿ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/data-api.html#data-api.enabling)ã€‚


ã€Œ[Build a GraphQL API for your Amazon Aurora MySQL database using AWS AppSync and the RDS Data API](https://aws.amazon.com/jp/blogs/mobile/build-a-graphql-api-for-your-amazon-aurora-mysql-database-using-aws-appsync-and-the-rds-data-api/)ã€ã§ã¯ Aurora Serverless v1 (MySQL) ã«å¯¾ã—ã¦ AWS AppSync ã¨ RDS Data API ã‚’ä½¿ã£ã¦ GraphQL API ã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã®ã§ã€ä»Šå›ã¯ã€**Amazon Aurora Serverless v2 (PostgreSQL) ã§ AWS AppSync ã®æ–°ã—ã„æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã®ã‹ã©ã†ã‹æ¤œè¨¼ã—ã¦ã¿ã¾ã™**ï¼

:::note warn
å†…å®¹ã«ä¸å‚™ã€ã‚ã‚‹ã„ã¯è¿½åŠ æƒ…å ±ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€æ°—è»½ã«ã‚³ãƒ¡ãƒ³ãƒˆé ‚ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ï¼
:::

## Step1. Amazon Aurora Serverless v2 (PostgreSQL) ã®ä½œæˆ

ã¾ãšã€Aurora Serverless v2 (PostgreSQL) ã® DB ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚æ‰‹é †ã«ã¤ã„ã¦ã¯ã€Œ[Aurora PostgreSQL DB ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆã¨æ¥ç¶š](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/CHAP_GettingStartedAurora.CreatingConnecting.AuroraPostgreSQL.html)ã€ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

DB ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆãŒå®Œäº†ã—ãŸã‚‰ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã«ã—ã¾ã™ã€‚

```sql
CREATE TABLE conversations (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE messages (
  id UUID PRIMARY KEY,
  conversation_id INT NOT NULL,
  sub UUID NOT NULL,
  body TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (conversation_id) REFERENCES conversations(id)
);

CREATE TABLE conversation_participants (
  conversation_id INT NOT NULL,
  sub UUID NOT NULL,
  last_read_at TIMESTAMP WITH TIME ZONE,
  PRIMARY KEY (conversation_id, sub),
  FOREIGN KEY (conversation_id) REFERENCES conversations(id)
);
```

## Step2. Secret Manager ã« DB èªè¨¼æƒ…å ±ã®ä¿å­˜

AWS AppSync ã¯ Amazon Aurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«æ¥ç¶šã™ã‚‹éš›ã« Secret Manager ã«ä¿å­˜ã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ã‚¿ã‚¤ãƒ—ã‚’ã€ŒAmazon RDS ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èªè¨¼æƒ…å ±ã€ã‚’é¸æŠè‚¢ã€èªè¨¼æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠã—ã¾ã™ã€‚ãã‚Œä»¥å¤–ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã€ä½œæˆã«é€²ã¿ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-12-22 16.07.28.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3625536/15ad47c0-00cc-f5fe-62f8-900c1028cdc4.png)

## Step3. GraphQL API ã®ä½œæˆ
æ¬¡ã«ã€GraphQL API ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚GraphQL API ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã§ã€ŒAmazon Aurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‹ã‚‰å§‹ã‚ã‚‹ - Newã€ã‚’é¸æŠã—ã€æ¬¡ã«é€²ã¿ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-12-22 13.22.27.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3625536/ed6becfe-5a77-8b90-277d-2828aff2fb93.png)

æ¬¡ã«ã€API åã«ã‚ã‹ã‚Šæ˜“ã„åå‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ä»Šå›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã€ŒMy AppSync APIã€ã¨ã—ã¾ã—ãŸã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-12-22 13.23.45.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3625536/fb231f5f-56d5-1f1a-1fce-d392c630ca20.png)

æ¬¡ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠã—ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-12-22 16.13.17.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3625536/c105701d-1b6f-7771-1acf-a8f8fa93673f.png)

ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ¥ç¶šã—ãŸã„ Amazon Aurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒé¸æŠå‡ºæ¥ã¾ã™ã€‚AWS Secret  Manager ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ Step2 ã§ä½œæˆã—ãŸã‚‚ã®ã‚’é¸æŠã—ã¾ã™ã€‚å…¥åŠ›ãŒçµ‚ãˆãŸã‚‰ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![database.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3625536/b5b191d1-bbcf-2bf9-ffc0-a98241014984.png)

ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚¤ãƒ³ãƒˆãƒ­ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã•ã‚Œã€ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚ã‚¿ã‚¤ãƒ—åã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚(ç”»åƒã¯å¤‰æ›´å‰ã§ã™ã€‚)

* `Conversation_participants` : `Participant`
* `Conversations` : `Conversation`
* `Messages` : `Message`

å•é¡Œãªã‘ã‚Œã°ã€ã€Œæ¬¡ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-12-22 13.31.13.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3625536/7b54176f-d936-c1f1-babb-7c64a78ff382.png)

ã‚¹ã‚­ãƒ¼ãƒã®è¨­å®šã§ã¯ã€ã‚¯ã‚¨ãƒªã®ã¿ã‚’ä½œæˆã™ã‚‹ã‹ã€ã‚¯ã‚¨ãƒªã€ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã‹ã‚’é¸æŠã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ä»Šå›ã¯ã€ã€Œã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦ã‚¯ã‚¨ãƒªã€ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã€ã‚’é¸æŠã—ã¾ã™ã€‚ã“ã‚Œã§ GraphQL API ã®ä½œæˆã¯å®Œäº†ã§ã™ï¼

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-12-22 13.31.31.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3625536/9be8fb68-3655-102d-1941-dd5928b7a5d1.png)

## Step4. å‹•ä½œç¢ºèª

ã§ã¯ã€å®Ÿéš›ã«ã©ã‚“ãªã‚¹ã‚­ãƒ¼ãƒã‚„ãƒªã‚¾ãƒ«ãƒãƒ¼ãŒä½œæˆã•ã‚ŒãŸã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯ã‚¹ã‚­ãƒ¼ãƒã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ç¢ºèª 1 : GraphQL ã‚¹ã‚­ãƒ¼ãƒ

ä»¥ä¸‹ãŒè‡ªå‹•ã§ç”Ÿæˆã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒ (ä¸€éƒ¨æŠœç²‹) ã§ã™ã€‚æ­£ç›´åˆã‚ã¦ã‚„ã£ãŸã¨ãã«çµæ§‹æ„Ÿå‹•ã—ã¾ã—ãŸã€‚ãŸã ã€ä¸€ç‚¹æ°—ã«ãªã£ãŸã“ã¨ã¨ã—ã¦ã¯ `created_at` ãŒ `String` ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚Amazon Aurora PostgreSQL ã®å ´åˆã€RDS Data API ã¯å¸¸ã« UTC ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã® Aurora PostgreSQL ãƒ‡ãƒ¼ã‚¿å‹ `TIMESTAMPTZ` ã‚’è¿”ã™ã®ã§ã™ãŒã€[AWS AppSync ã®ã‚¹ã‚«ãƒ©ãƒ¼å‹ã§ã¯ `TIMESTAMPTZ` ã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚‰ãšã€ã‹ã¤ AWS AppSync ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚«ãƒ©ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚](https://docs.aws.amazon.com/appsync/latest/devguide/scalars.html)ãã®ãŸã‚ã€ãƒªã‚¾ãƒ«ãƒãƒ¼å´ã§å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚

(ä»Šå›ã¯åŠ›å°½ããŸã®ã§ãƒªã‚¾ãƒ«ãƒãƒ¼ã¯ã„ã˜ã‚Šã¾ã›ã‚“..ã¾ãŸã®æ©Ÿä¼šã‚’ãŠæ¥½ã—ã¿ã«...)

```graphql
type Conversation {
    name: String!
    created_at: String
    id: Int!
}

type ConversationConnection {
    items: [Conversation]
    nextToken: String
}

input CreateConversationInput {
    name: String!
    created_at: String
    id: Int!
}

input CreateMessageInput {
    created_at: String
    conversation_id: Int!
    id: ID!
    body: String!
    sub: ID!
}

input CreateParticipantInput {
    conversation_id: Int!
    last_read_at: String
    sub: ID!
}

input DeleteConversationInput {
    id: Int!
}

input DeleteMessageInput {
    id: ID!
}

input DeleteParticipantInput {
    conversation_id: Int!
    sub: ID!
}

type Message {
    created_at: String
    conversation_id: Int!
    id: ID!
    body: String!
    sub: ID!
}

type MessageConnection {
    items: [Message]
    nextToken: String
}

type Participant {
    conversation_id: Int!
    last_read_at: String
    sub: ID!
}

type ParticipantConnection {
    items: [Participant]
    nextToken: String
}

(ã€œã€œã€œã€œã€œã€œã€œã€œã€œçœç•¥ã€œã€œã€œã€œã€œã€œã€œã€œã€œ)

type Mutation {
    createMessage(input: CreateMessageInput!): Message
    updateMessage(input: UpdateMessageInput!, condition: TableMessageConditionInput): Message
    deleteMessage(input: DeleteMessageInput!, condition: TableMessageConditionInput): Message
    createConversation(input: CreateConversationInput!): Conversation
    updateConversation(input: UpdateConversationInput!, condition: TableConversationConditionInput): Conversation
    deleteConversation(input: DeleteConversationInput!, condition: TableConversationConditionInput): Conversation
    createParticipant(input: CreateParticipantInput!): Participant
    updateParticipant(input: UpdateParticipantInput!, condition: TableParticipantConditionInput): Participant
    deleteParticipant(input: DeleteParticipantInput!, condition: TableParticipantConditionInput): Participant
}

type Query {
    getMessage(id: ID!): Message
    listMessages(filter: TableMessageFilterInput, limit: Int, nextToken: String): MessageConnection
    getConversation(id: Int!): Conversation
    listConversations(filter: TableConversationFilterInput, limit: Int, nextToken: String): ConversationConnection
    getParticipant(conversation_id: Int!, sub: ID!): Participant
    listParticipants(filter: TableParticipantFilterInput, limit: Int, nextToken: String): ParticipantConnection
}

type Subscription {
    onCreateMessage(
        created_at: String,
        conversation_id: Int,
        id: ID,
        body: String,
        sub: ID
    ): Message
        @aws_subscribe(mutations: ["createMessage"])
    onUpdateMessage(
        created_at: String,
        conversation_id: Int,
        id: ID,
        body: String,
        sub: ID
    ): Message
        @aws_subscribe(mutations: ["updateMessage"])
    onDeleteMessage(
        created_at: String,
        conversation_id: Int,
        id: ID,
        body: String,
        sub: ID
    ): Message
        @aws_subscribe(mutations: ["deleteMessage"])
    onCreateConversation(name: String, created_at: String, id: Int): Conversation
        @aws_subscribe(mutations: ["createConversation"])
    onUpdateConversation(name: String, created_at: String, id: Int): Conversation
        @aws_subscribe(mutations: ["updateConversation"])
    onDeleteConversation(name: String, created_at: String, id: Int): Conversation
        @aws_subscribe(mutations: ["deleteConversation"])
    onCreateParticipant(conversation_id: Int, last_read_at: String, sub: ID): Participant
        @aws_subscribe(mutations: ["createParticipant"])
    onUpdateParticipant(conversation_id: Int, last_read_at: String, sub: ID): Participant
        @aws_subscribe(mutations: ["updateParticipant"])
    onDeleteParticipant(conversation_id: Int, last_read_at: String, sub: ID): Participant
        @aws_subscribe(mutations: ["deleteParticipant"])
}
```
### ç¢ºèª 2 : ãƒªã‚¾ãƒ«ãƒãƒ¼
æ¬¡ã«ã€ãƒªã‚¾ãƒ«ãƒãƒ¼ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚ä»¥ä¸‹ã¯ `createMessage` ã®ãƒªã‚¾ãƒ«ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
JavaScript ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§èª­ã¿ã‚„ã™ã„ã§ã™ã­ã€‚

```javascript
import { util } from '@aws-appsync/utils';
import { insert, createPgStatement, toJsonObject } from '@aws-appsync/utils/rds';

/**
 * Puts an item into the messages table using the supplied input.
 * @param {import('@aws-appsync/utils').Context} ctx the context
 * @returns {*} the request
 */
export function request(ctx) {
    const { input } = ctx.args;
    const insertStatement = insert({
        table: 'messages',
        values: input,
        returning: '*',
    });
    return createPgStatement(insertStatement)
}

/**
 * Returns the result or throws an error if the operation failed.
 * @param {import('@aws-appsync/utils').Context} ctx the context
 * @returns {*} the result
 */
export function response(ctx) {
    const { error, result } = ctx;
    if (error) {
        return util.appendError(
            error.message,
            error.type,
            result
        )
    }
    return toJsonObject(result)[0][0]
}
```

### ç¢ºèª 3 : GraphQL ã‚¹ã‚­ãƒ¼ãƒã®ä½œæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°
æœ€å¾Œã« AWS AppSync ã® GraphQL ã‚¹ã‚­ãƒ¼ãƒä½œæˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ãŸã€‚
`conversations` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `status` ã¨ã„ã†ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ãŸã€‚

```sql
ALTER TABLE conversations ADD COLUMN status VARCHAR(100);
```
ã“ã‚Œã§ã€ AWS AppSync ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å´ã§ã‚¹ã‚­ãƒ¼ãƒã®åæ˜ ãŒã§ãã‚Œã°...ã¨æ€ã„ã¾ã—ãŸãŒã€ç¾æ™‚ç‚¹ (2023 å¹´ 12 æœˆ 22 æ—¥) æ™‚ç‚¹ã§ã¯ã‚¹ã‚­ãƒ¼ãƒã®åæ˜ ã¯ GraphQL API ã‚’æ–°è¦ä½œæˆã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã ã‘ã§ã—ãŸã€‚æ—¢å­˜ã® GraphQL API ã«ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’æ–°è¦è¿½åŠ ã™ã‚‹éš›ã«ã‚‚ã‚¹ã‚­ãƒ¼ãƒã¯åæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚ä»Šå¾Œã® Update ã«æœŸå¾…ã§ã™ã­ã€‚

## ã¾ã¨ã‚

ä»Šå›ã¯ã€AWS AppSync ã® RDS Data API ã‚’ä½¿ç”¨ã—ã¦ Amazon Aurora Serverless v2 (PostgreSQL) ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦[ã‚¤ãƒ³ãƒˆãƒ­ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³](https://graphql.org/learn/introspection/)ã‚’è¡Œã†ã“ã¨ã§ã€æ¤œå‡ºã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã«é©åˆã—ãŸ GraphQL API ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’ä½œæˆã™ã‚‹æ©Ÿèƒ½ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚ã‚¹ã‚«ãƒ©ãƒ¼ã®å•é¡ŒãŒã‚ã£ãŸãŸã‚ã€å°‘ã—æ‰‹ã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€çˆ†é€Ÿã§æ§‹ç¯‰ã§ããŸã“ã¨ã«é©šãã¾ã—ãŸã€‚

[AWS AppSync ã¯ 2023 å¹´ã«å¤šãã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒã‚ã‚Š](https://speakerdeck.com/inariku/14)ã€ã“ã‚Œã‹ã‚‰ãŒæ¥½ã—ã¿ã§ã™ã€‚

æ˜æ—¥ã‹ã‚‰æ—…è¡Œã«è¡Œãã®ã§ã“ã“ã§ãŠã—ã¾ã„ã¨ã—ã¾ã™ã€‚ç¶šå ±ã‚’ãŠæ¥½ã—ã¿ã«

